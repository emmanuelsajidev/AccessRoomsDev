<template>
  <div>
    <v-snackbar v-model="showSnackBar" color="black">
      <v-layout wrap justify-center>
        <v-flex text-left class="align-self-center">
          <span style="color: white">
            {{ msg }}
          </span>
        </v-flex>
        <v-flex text-right>
          <v-btn small :ripple="false" text @click="showSnackBar = false">
            <v-icon style="color: white">mdi-close</v-icon>
          </v-btn>
        </v-flex>
      </v-layout>
    </v-snackbar>
    <vue-element-loading
      :active="appLoading"
      :is-full-screen="true"
      background-color="#FFFFFF"
      color="#FF681F"
      spinner="spinner"
    />
    <v-layout wrap pb-9 justify-space-around class="mainfont">
      <v-flex xs11>
        <v-layout wrap pr-1 pt-7 justify-center>
          <v-flex x12 text-left>
            <span class="mainfont" style="font-size: 25px; font-weight: bolder"
              >EDIT DETAILS</span
            >
          </v-flex>
        </v-layout>
      </v-flex>
      <v-flex xs11 pt-4>
        <v-card class="pa-5">
          <v-layout wrap justify-start pt-6>
            <v-flex xs12 pb-8>
              <v-layout wrap>
                <v-flex xs12 pb-4 style="font-weight: bold">
                  Basic Details
                </v-flex>
                <v-flex xs12 sm6 lg4 pr-3>
                  <span>Name</span>
                  <v-text-field
                    style="border-radius: opx"
                    dense
                    outlined
                    v-model="list.name"
                  >
                  </v-text-field>
                </v-flex>
                <!-- <v-flex xs12  lg4 pr-3>
                  <span>E-mail</span>

                  <v-text-field
                    style="border-radius: opx"
                    dense
                    outlined
                    v-model="list.email"
                  >
                  </v-text-field>
                </v-flex> -->

                <v-flex xs12  sm6 lg4 pr-3>
                  <span>Link</span>

                  <v-text-field
                    style="border-radius: opx"
                    dense
                    outlined
                    v-model="list.link"
                  >
                  </v-text-field>
                </v-flex>

                <v-flex xs12 sm6 lg4 pr-3>
                  <span>Locality</span>

                  <v-text-field
                    style="border-radius: opx"
                    dense
                    outlined
                    v-model="list.locality"
                  >
                  </v-text-field>
                </v-flex>
                <v-flex xs12 sm6 lg4 pr-3>
                  <span>District</span>

                  <v-text-field
                    style="border-radius: opx"
                    dense
                    outlined
                    v-model="list.district"
                  >
                  </v-text-field>
                </v-flex>
                <v-flex xs12 sm6 lg4 pr-3>
                  <span>State</span>

                  <v-text-field
                    style="border-radius: opx"
                    dense
                    outlined
                    v-model="list.state"
                  >
                  </v-text-field>
                </v-flex>

                <v-flex xs12 sm6 lg4 pr-3>
                  <span>Country</span>

                  <v-text-field
                    style="border-radius: opx"
                    dense
                    outlined
                    v-model="list.country"
                  >
                  </v-text-field> </v-flex
                ><v-flex xs12 sm6 lg4 pr-3>
                  <span>Pincode</span>

                  <v-text-field
                    style="border-radius: opx"
                    dense
                    outlined
                    v-model="list.pincode"
                  >
                  </v-text-field>
                </v-flex>
                <v-flex xs12 sm6 lg4 pr-3>
                  <span>Vendor Category</span>
                  <v-select
                    v-model="list.vendorCategory"
                    hide-details="auto"
                    :items="vendorCatList"
                    :menu-props="{ maxHeight: '400' }"
                    Placeholder="Select"
                    item-text="categoryType"
                    item-value="_id"
                    multiple
                    outlined
                    persistent-hint
                    dense
                  ></v-select>
                </v-flex>
              </v-layout>
            </v-flex>
            <v-flex xs12  pb-8>
              <v-layout wrap justify-center>
                <v-flex pb-4 pt-10 style="font-weight: bold">
                  Company details
                </v-flex>
              </v-layout>
              <v-layout wrap justify-start>
                <v-flex xs12 sm6 lg4 pr-3>
                  <span>Company Name</span>

                  <v-text-field
                    style="border-radius: opx"
                    dense
                    outlined
                    v-model="list.companyName"
                  >
                  </v-text-field> </v-flex
                ><v-flex xs12 sm6 lg4 pr-3>
                  <span>GST Number</span>

                  <v-text-field
                    style="border-radius: opx"
                    dense
                    outlined
                    v-model="list.gstNo"
                  >
                  </v-text-field>
                </v-flex>

                <v-flex xs12>
                  <v-layout wrap>
                    <v-flex>
                      <v-layout wrap>
                        <v-flex xs12 sm6 lg4>
                          <span>Voter Id Proof</span>

                          <v-btn
                            color="#3E69B4"
                            block
                            dark
                            download
                            :href="mediaURLnewx + vendorId.voteridProof"
                            target="_blank"
                          >
                            <v-icon>mdi-file-document-outline</v-icon
                            ><span
                              style="
                                font-family: mainfont;
                                font-weight: 400;
                                font-size: 16px;
                                text-transform: none;
                              "
                              >View</span
                            ></v-btn
                          >
                        </v-flex>
                        <v-flex xs12 sm6 lg4 pl-4 pt-2>
                          <v-file-input
                            v-model="file1"
                            label="Add file "
                            @change="handleFileChange('file1')"
                          ></v-file-input>
                        </v-flex>
                      </v-layout>
                    </v-flex>
                    <v-flex>
                      <v-layout wrap>
                        <v-flex xs12 sm6 lg4>
                          <span>License Proof</span>

                          <v-btn
                            color="#3E69B4"
                            block
                            dark
                            download
                            :href="mediaURLnewx + vendorId.licenseProof"
                            target="_blank"
                          >
                            <v-icon>mdi-file-document-outline</v-icon
                            ><span
                              style="
                                font-family: mainfont;
                                font-weight: 400;
                                font-size: 16px;
                                text-transform: none;
                              "
                              >View</span
                            ></v-btn
                          >
                        </v-flex>
                        <v-flex xs12 sm6 lg4 pl-4 pt-2>
                          <v-file-input
                            class="mainfont"
                            v-model="file2"
                            label="Add  file"
                            @change="handleFileChange('file2')"
                          ></v-file-input>
                        </v-flex>
                      </v-layout>
                    </v-flex>
                  </v-layout>
                </v-flex>
              </v-layout>
            </v-flex>
            <v-flex xs12>
              <v-layout wrap justify-center>
                <v-flex pb-4 pt-10 style="font-weight: bold">
                  Bank details
                </v-flex>
              </v-layout>
              <v-layout wrap justify-start>
                <v-flex xs12 sm6 lg4 pr-3>
                  <span>Bank Name</span>

                  <v-text-field
                    style="border-radius: opx"
                    dense
                    outlined
                    v-model="bankDetails.bankName"
                  >
                  </v-text-field> </v-flex
                ><v-flex xs12 sm6  lg4 pr-3>
                  <span>Account Holder Name</span>

                  <v-text-field
                    style="border-radius: opx"
                    dense
                    outlined
                    v-model="bankDetails.accHolderName"
                  >
                  </v-text-field> </v-flex
                ><v-flex xs12 sm6 lg4 pr-3>
                  <span>Account Number</span>

                  <v-text-field
                    style="border-radius: opx"
                    dense
                    outlined
                    v-model="bankDetails.accNo"
                  >
                  </v-text-field> </v-flex
                ><v-flex xs12 sm6 lg4 pr-3>
                  <span>Account Type</span>

                  <v-text-field
                    style="border-radius: opx"
                    dense
                    outlined
                    v-model="bankDetails.accType"
                  >
                  </v-text-field> </v-flex
                ><v-flex xs12 sm6 lg4 pr-3>
                  <span>IFSC Code</span>

                  <v-text-field
                    style="border-radius: opx"
                    dense
                    outlined
                    v-model="bankDetails.ifscCode"
                  >
                  </v-text-field>
                </v-flex>
                <v-flex xs12 sm6 lg4 pr-3>
                  <span>Branch</span>

                  <v-text-field
                    style="border-radius: opx"
                    dense
                    outlined
                    v-model="bankDetails.branchName"
                  >
                  </v-text-field>
                </v-flex>
                <v-flex xs12 sm6 lg4 pr-3>
                  <span>UPID</span>

                  <v-text-field
                    style="border-radius: opx"
                    dense
                    outlined
                    v-model="bankDetails.upiId"
                  >
                  </v-text-field>
                </v-flex>
                <v-flex xs12>
                  <v-layout wrap>
                    <v-flex>
                      <v-layout wrap>
                        <v-flex xs12 sm6  lg4>
                          <span>Qr code</span>

                          <v-btn
                            color="#3E69B4"
                            block
                            dark
                            download
                            :href="mediaURLnewx + bankDetails.qrCode"
                            target="_blank"
                          >
                            <v-icon>mdi-file-document-outline</v-icon
                            ><span
                              style="
                                font-family: mainfont;
                                font-weight: 400;
                                font-size: 16px;
                                text-transform: none;
                              "
                              >View</span
                            ></v-btn
                          >
                        </v-flex>
                        <v-flex xs12 sm6 lg4 pl-4 pt-2>
                          <v-file-input
                            v-model="file3"
                            label="Add file "
                            @change="handleFileChange('file3')"
                          ></v-file-input>
                        </v-flex>
                      </v-layout>
                    </v-flex>
                    <v-flex>
                      <v-layout wrap>
                        <v-flex xs12 sm6 lg4>
                          <span>Pass Book</span>

                          <v-btn
                            color="#3E69B4"
                            block
                            dark
                            download
                            :href="mediaURLnewx + bankDetails.passBook"
                            target="_blank"
                          >
                            <v-icon>mdi-file-document-outline</v-icon
                            ><span
                              style="
                                font-family: mainfont;
                                font-weight: 400;
                                font-size: 16px;
                                text-transform: none;
                              "
                              >View</span
                            ></v-btn
                          >
                        </v-flex>
                        <v-flex xs12 sm6 lg4 pl-4 pt-2>
                          <v-file-input
                            v-model="file4"
                            label="Add file "
                            @change="handleFileChange('file4')"
                          ></v-file-input>
                        </v-flex>
                      </v-layout>
                    </v-flex>
                  </v-layout>
                </v-flex>
              </v-layout>
            </v-flex>
          </v-layout>
          <v-layout wrap>
            <v-flex xs12 pt-10>
              <v-layout wrap justify-end>
                <v-flex xs12 lg2>
                  <v-btn @click="editVendor()" color="#FF681F" block>
                    <span style="color: white"> Edit </span>
                    <v-icon size="100%" color="white">mdi-pencil</v-icon>
                  </v-btn>
                </v-flex>
              </v-layout>
            </v-flex>
          </v-layout>
        </v-card>
      </v-flex>
    </v-layout>
  </div>
</template>
<script>
import axios from "axios";
export default {
  components: {},
  data() {
    return {
      file1: null,
      file2: null,
      file3: null,
      file4: null,
      vendorCatList: [],
      showSnackBar: false,
      deletedialog: false,
      description: "",
      id: this.$route.query.id,
      ServerError: false,
      timeout: 5000,
      bankDetails: {},
      bankDetails2: {},
      formData: new FormData(),
      msg: null,
      dialog: false,
      editdialog: false,
      vendorId: {},
      appLoading: false,
      list: {},
    };
  },
  computed: {},

  mounted() {
    this.getList();
    this.getData();
  },
  watch: {
    currentPage() {
      this.getList();
    },
  },

  methods: {
    triggerFileInput(refName) {
      if (this.$refs[refName]) {
        this.$refs[refName].$refs.input.click();
      }
    },
    handleFileChange(refName) {
      console.log(`File ${refName} selected`);
    },

    editVendor() {
      const formData = new FormData();

      const bankDetails22 = {
        bankName: this.bankDetails.bankName,
        accHolderName: this.bankDetails.accHolderName,
        accNo: this.bankDetails.accNo,
        accType: this.bankDetails.accType,
        ifscCode: this.bankDetails.ifscCode,
        branchName: this.bankDetails.branchName,
        upiId: this.bankDetails.upiId,
      };

      formData.append("id", this.$route.query.id);
      const bankDetailsString = JSON.stringify(bankDetails22);
      formData.append("bankDetails", bankDetailsString);
      formData.append("qrCode", this.file3);
      formData.append("passBook", this.file4);
      formData.append("name", this.list.name);
      formData.append("link", this.list.link);
      formData.append("email", this.list.email);
      formData.append("district", this.list.district);
      formData.append("locality", this.list.locality);
      formData.append("state", this.list.state);
      formData.append("country", this.list.country);
      formData.append("pincode", this.list.pincode);
      formData.append("companyName", this.list.companyName);
      formData.append("gstNo", this.list.gstNo);
      formData.append("voteridProof", this.file1);
      formData.append("licenseProof", this.file2);
      formData.append("upiId", this.bankDetails.upiId);
      formData.append(
        "vendorCategory",
        JSON.stringify(this.list.vendorCategory)
      );

      axios({
        method: "POST",
        url: "/vendor/edit",
        headers: {
          token: localStorage.getItem("token"),
          "Content-Type": "multipart/form-data",
        },
        data: formData,
      })
        .then((response) => {
          if (response.data.status == true) {
            this.id = response.data.data._id;
            this.msg = response.data.msg;
            this.showSnackBar = true;
            location.reload();
          } else {
            this.msg = response.data.msg;
            this.showSnackBar = true;
          }
        })
        .catch((err) => {
          this.ServerError = true;
          console.error(err);
        });

      // Clear the formData for the next use
      // (Note: If you're using this inside a Vue component, you might want to use a reactive property instead)
      this.formData = new FormData();
    },

    getList() {
      this.appLoading = true;
      axios
        .get("/vendor/info", {
          headers: {
            token: localStorage.getItem("token"),
          },
          params: {
            id: this.id,
          },
        })
        .then((response) => {
          this.appLoading = false;
          this.list = response.data.data;
          this.bankDetails = this.list.vendorId.bankDetails;
          this.vendorId = this.list.vendorId;
        })
        .catch((err) => {
          this.appLoading = false;
          this.ServerError = true;
          console.log(err);
        });
    },
    getData() {
      this.appLoading = true;
      axios({
        method: "GET",
        url: "/vendor/category/getlist",
      })
        .then((response) => {
          this.appLoading = false;
          if (response.data.status) {
            this.vendorCatList = response.data.data;
          } else {
            this.msg = response.data.msg;
            this.showsnackbar = true;
          }
        })
        .catch((err) => {
          this.appLoading = false;
          console.log(err);
          this.ServerError = true;
        });
    },

    submit() {
      this.formData.append("id", this.id);
      this.formData.append("photo", this.topImage);
      axios({
        method: "POST",
        url: "/location/singleimageupload",
        headers: {
          token: localStorage.getItem("token"),
        },
        data: this.formData,
      })
        .then((response) => {
          if (response.data.status == true) {
            this.dialog2 = false;
            this.msg = response.data.msg;
            this.showSnackBar = true;
            location.reload();
          } else {
            this.msg = response.data.msg;
            this.showSnackBar = true;
          }
        })
        .catch((err) => {
          this.ServerError = true;
          console.log(err);
        });
    },
  },
};
</script>
<style >
.justified-text {
  text-align: justify;
}

.cus {
  background-color: #13736f;
}

.no-uppercase {
  text-transform: none !important;
}

.cus2 {
  background: var(
    --grend,
    linear-gradient(
      252deg,
      #e4ecee 0%,
      #9bc2c2 0%,
      #6ca6a5 28%,
      #157470 88%,
      #13736f 100%
    )
  );
}
</style>